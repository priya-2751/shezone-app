<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>track your child- SheZone</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap');

    body {
      margin: 0;
      font-family: 'Comfortaa', cursive, Arial, sans-serif;
      background: linear-gradient(135deg, #ffe6f2, #ffb3d1);
      display: flex;
      flex-direction: column;
      height: 100vh;
      color: #9c1d5d;
      user-select: none;
    }

    h1 {
      margin: 0;
      padding: 1.5rem 1rem;
      text-align: center;
      font-size: 2.5rem;
      font-weight: 900;
      color: #d81e5b;
      text-shadow: 1px 1px 5px rgba(216, 30, 91, 0.3);
      background: #fff0f6;
      border-bottom: 3px solid #d81e5b;
      user-select: text;
    }

    #map {
      flex-grow: 1;
      border-radius: 30px;
      margin: 1rem auto 1.5rem;
      max-width: 960px;
      width: 95%;
      box-shadow:
        0 20px 50px rgba(216, 30, 91, 0.25),
        inset 0 0 30px rgba(255, 182, 193, 0.3);
      border: 5px solid #f48fb1;
    }

    /* Custom pink marker icon using Leaflet DivIcon */
    .pink-marker {
      background-color: #d81e5b;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 0 8px rgba(216, 30, 91, 0.7);
      border: 2px solid #ffb3d1;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>track your child - SheZone</h1>
  <div id="map"></div>

  <script>
    // ----- Firebase config -----
    const firebaseConfig = {
      apiKey: "AIzaSyCpd0NHTmbe1WTqdhK0Bw26xvrtRh05EoE",
      authDomain: "shezoneapp.firebaseapp.com",
      databaseURL:"https://shezoneapp-default-rtdb.firebaseio.com/",
      projectId: "shezoneapp",
      storageBucket: "shezoneapp.firebasestorage.app",
      messagingSenderId: "178639823528",
      appId: "1:178639823528:web:161605cc37dc724c7a589d",
      measurementId: "G-C8TP9HVVFZ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ----- Initialize Leaflet Map -----
    const map = L.map('map').setView([13.0827, 80.2707], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© OpenStreetMap contributors'
    }).addTo(map);

    const childMarkers = {};

    // Create a pink circular DivIcon with girl emoji label
    function createPinkMarkerIcon(label) {
      return L.divIcon({
        className: 'pink-marker',
        html: label,
        iconSize: [28, 28],
        iconAnchor: [14, 28],
        popupAnchor: [0, -28],
      });
    }

    // Listen for child location updates
    db.ref('children').on('value', snapshot => {
      const children = snapshot.val();
      if (!children) return;

      for (let id in children) {
        const { lat, lng } = children[id];
        if (childMarkers[id]) {
          childMarkers[id].setLatLng([lat, lng]);
        } else {
          // Use girl emoji ðŸ‘§ as label for all child markers
          const label = 'ðŸ‘§';
          childMarkers[id] = L.marker([lat, lng], {
            icon: createPinkMarkerIcon(label)
          }).addTo(map).bindPopup(`<strong>Child:</strong> ${id}`);
        }
        // Pan map smoothly to last updated child's location
        map.panTo([lat, lng], { animate: true, duration: 1.2 });
      }
    });
  </script>
</body>
</html>
